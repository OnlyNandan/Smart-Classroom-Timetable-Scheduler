{% extends "base.html" %}
{% from "macros.html" import form_field, form_submit, data_table %}

{% block title %}Manage Teachers{% endblock %}
{% block header %}Teacher Management{% endblock %}

{% block content %}
<div class="container mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Add Form -->
    <div class="lg:col-span-1 glass-card p-6 rounded-2xl shadow-lg h-fit">
        <h3 class="text-xl font-semibold mb-6 text-gray-800 dark:text-white">Add New Teacher</h3>
        <form method="POST" action="{{ url_for('manage_teachers') }}" class="space-y-6">
            {{ form_field('teacher_id', 'Teacher ID', 'text', required=True) }}
            {{ form_field('teacher_name', 'Teacher Name', 'text', required=True) }}
            {{ form_field('max_hours_week', 'Max Hours/Week', 'number', required=True) }}

            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Teachable Grades</label>
                <div class="mt-2 p-3 bg-white/50 dark:bg-gray-900/50 rounded-lg max-h-40 overflow-y-auto space-y-2">
                    {% for grade in grades %}
                    <div class="flex items-center">
                        <input id="grade_{{ grade.id }}" name="grades" type="checkbox" value="{{ grade.id }}" class="h-4 w-4 rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                        <label for="grade_{{ grade.id }}" class="ml-3 min-w-0 flex-1 text-gray-700 dark:text-gray-300">{{ grade.name }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Teachable Courses (Subjects)</label>
                <div class="mt-2 p-3 bg-white/50 dark:bg-gray-900/50 rounded-lg max-h-40 overflow-y-auto space-y-2">
                    {% for course in courses %}
                     <div class="flex items-center">
                        <input id="course_{{ course.course_id }}" name="courses" type="checkbox" value="{{ course.course_id }}" class="h-4 w-4 rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                        <label for="course_{{ course.course_id }}" class="ml-3 min-w-0 flex-1 text-gray-700 dark:text-gray-300">{{ course.course_name }} ({{course.grade.name}})</label>
                    </div>
                    {% endfor %}
                </div>
            </div>

            {{ form_submit('Add Teacher') }}
        </form>
    </div>

    <!-- Data List -->
    <div class="lg:col-span-2 glass-card p-6 rounded-2xl shadow-lg">
        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Existing Teachers</h3>
        <div class="overflow-x-auto">
            <table class="min-w-full">
                <thead>
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Grades</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Courses</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200/50 dark:divide-gray-700/50">
                    {% for teacher in teachers %}
                    <tr class="hover:bg-gray-50/50 dark:hover:bg-gray-800/50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap align-top">
                            <div class="font-medium text-gray-900 dark:text-white">{{ teacher.teacher_name }}</div>
                            <div class="text-xs text-gray-500">{{ teacher.teacher_id }} | Max {{ teacher.max_hours_week }}h/w</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap align-top">
                            <div class="flex flex-wrap gap-1">
                                {% for grade in teacher.grades %}
                                    <span class="text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-200 py-0.5 px-2 rounded-full">{{ grade.name }}</span>
                                {% endfor %}
                            </div>
                        </td>
                        <td class="px-6 py-4 align-top">
                            <div class="flex flex-col space-y-1">
                                {% for course in teacher.courses %}
                                    <span class="text-xs text-gray-700 dark:text-gray-300">{{ course.course_name }}</span>
                                {% else %}
                                    <span class="text-xs text-gray-500">None</span>
                                {% endfor %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
